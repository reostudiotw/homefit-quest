<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HomeFit Quest - ä½ çš„å°ˆå±¬å¥èº«ç©ºé–“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #020617; /* slate-950 */
            color: #f1f5f9;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .classic-card {
            background: #0f172a; /* slate-900 */
            border: 1px solid #1e293b;
            border-radius: 1.5rem;
        }
        .active-tab-shadow {
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.4);
        }
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 1.5rem;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        const STORAGE_KEYS = {
            USER: 'homefit_user_profile',
            LIB: 'homefit_exercise_lib',
            PLAN: 'homefit_current_week_plan',
            STATS: 'homefit_workout_stats',
            REWARDS: 'homefit_rewards'
        };

        const DEFAULT_EXERCISES = [
            { id: '1', name: 'æš–èº«é‹å‹•', type: 'æœ‰æ°§', intensity: 'ä½', ytUrl: 'https://www.youtube.com/watch?v=sU_E71589C4', duration: 5 },
            { id: '2', name: 'è¶…æ…¢è·‘', type: 'æœ‰æ°§', intensity: 'ä¸­', ytUrl: 'https://www.youtube.com/watch?v=Fst8V6t6e2Y', duration: 20 },
            { id: '3', name: 'ç·©å’Œä¼¸å±•', type: 'æœ‰æ°§', intensity: 'ä½', ytUrl: 'https://www.youtube.com/watch?v=M9S_V9p6WSw', duration: 5 },
            { id: '4', name: 'å•éˆ´è¨“ç·´', type: 'è‚ŒåŠ›', intensity: 'ä¸­', ytUrl: 'https://www.youtube.com/watch?v=rW266P_S0D4', duration: 10 },
            { id: '5', name: 'æ£’å¼', type: 'æ ¸å¿ƒ', intensity: 'ä¸­', ytUrl: 'https://www.youtube.com/watch?v=pSHjTRCQxIw', duration: 5 }
        ];

        const MOTIVATION_QUOTES = ["ä»Šå¤©æˆ‘æœ‰å‹•", "å®Œæˆå°±å¥½", "æˆ‘æ²’æ”¾æ£„", "æ¯ä¸€ç§’éƒ½åœ¨è®Šç˜¦", "æ±—æ°´æ˜¯è„‚è‚ªçš„çœ¼æ·š"];

        // ä¿®æ­£ Lucide åœ–ç¤º
        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [name]);
            return (
                <span key={name} className={`inline-flex items-center justify-center ${className}`}>
                    <i data-lucide={name} style={{ width: size, height: size }}></i>
                </span>
            );
        };

        const getTypeColor = (type) => {
            switch(type) {
                case 'æœ‰æ°§': return 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30';
                case 'è‚ŒåŠ›': return 'bg-orange-500/20 text-orange-400 border-orange-500/30';
                case 'æ ¸å¿ƒ': return 'bg-blue-500/20 text-blue-400 border-blue-500/30';
                default: return 'bg-slate-500/20 text-slate-400 border-slate-500/30';
            }
        };

        function App() {
            const [activeTab, setActiveTab] = useState('plan');
            const [user, setUser] = useState(null);
            const [library, setLibrary] = useState(DEFAULT_EXERCISES);
            const [weekPlan, setWeekPlan] = useState([]);
            const [stats, setStats] = useState({ totalCompleted: 0, streak: 0 });
            const [rewards, setRewards] = useState([]);
            const [isInit, setIsInit] = useState(false);

            useEffect(() => {
                const sUser = localStorage.getItem(STORAGE_KEYS.USER);
                const sLib = localStorage.getItem(STORAGE_KEYS.LIB);
                const sPlan = localStorage.getItem(STORAGE_KEYS.PLAN);
                const sStats = localStorage.getItem(STORAGE_KEYS.STATS);
                const sRewards = localStorage.getItem(STORAGE_KEYS.REWARDS);

                if (sUser) setUser(JSON.parse(sUser));
                if (sLib) setLibrary(JSON.parse(sLib));
                if (sPlan) setWeekPlan(JSON.parse(sPlan));
                if (sStats) setStats(JSON.parse(sStats));
                if (sRewards) setRewards(JSON.parse(sRewards));
                setIsInit(true);
            }, []);

            const save = (key, data) => localStorage.setItem(key, JSON.stringify(data));

            if (!isInit) return <div className="h-screen flex items-center justify-center font-bold">è¼‰å…¥ä¸­...</div>;

            if (!user && activeTab !== 'setup') {
                return <SetupPage onDone={(d) => { setUser(d); save(STORAGE_KEYS.USER, d); setActiveTab('plan'); }} />;
            }

            return (
                <div className="min-h-screen flex flex-col pb-24 md:pb-0">
                    <nav className="bg-slate-900/80 border-b border-slate-800 p-4 sticky top-0 z-50 backdrop-blur-md">
                        <div className="max-w-7xl mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <div className="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center">
                                    <Icon name="flame" className="text-white fill-current" />
                                </div>
                                <h1 className="text-2xl font-black tracking-tighter uppercase">HomeFit <span className="text-indigo-400 font-light">Quest</span></h1>
                            </div>
                            <div className="hidden md:flex gap-4">
                                <NavBtn id="plan" icon="calendar" label="æœ¬é€±èª²è¡¨" active={activeTab==='plan'} onClick={setActiveTab} />
                                <NavBtn id="workout" icon="play-circle" label="é–‹å§‹é‹å‹•" active={activeTab==='workout'} onClick={setActiveTab} />
                                <NavBtn id="stats" icon="trophy" label="æ‰“å¡ç‰†" active={activeTab==='stats'} onClick={setActiveTab} />
                                <NavBtn id="lib" icon="dumbbell" label="å‹•ä½œåº«" active={activeTab==='lib'} onClick={setActiveTab} />
                                <NavBtn id="setup" icon="settings" label="è¨­å®š" active={activeTab==='setup'} onClick={setActiveTab} />
                            </div>
                        </div>
                    </nav>

                    <main className="flex-1 max-w-7xl mx-auto w-full p-4 md:p-8">
                        {activeTab === 'plan' && <PlanPage weekPlan={weekPlan} setWeekPlan={(p)=>{setWeekPlan(p); save(STORAGE_KEYS.PLAN, p);}} library={library} onStart={()=>setActiveTab('workout')} />}
                        {activeTab === 'workout' && <WorkoutPlayer weekPlan={weekPlan} onFinish={(idx)=>{
                            const newPlan = [...weekPlan];
                            newPlan[idx].completed = true;
                            setWeekPlan(newPlan); save(STORAGE_KEYS.PLAN, newPlan);
                            const newStats = { ...stats, totalCompleted: (stats.totalCompleted || 0) + 1, streak: (stats.streak || 0) + 1 };
                            setStats(newStats); save(STORAGE_KEYS.STATS, newStats);
                            setActiveTab('stats');
                        }}/>}
                        {activeTab === 'stats' && <StatsPage stats={stats} weekPlan={weekPlan} rewards={rewards} setRewards={(r)=>{setRewards(r); save(STORAGE_KEYS.REWARDS, r);}} />}
                        {activeTab === 'lib' && <LibraryPage library={library} setLibrary={(l)=>{setLibrary(l); save(STORAGE_KEYS.LIB, l);}} />}
                        {activeTab === 'setup' && <SetupPage user={user} onDone={(d)=>{setUser(d); save(STORAGE_KEYS.USER, d); setActiveTab('plan');}} />}
                    </main>

                    <div className="md:hidden fixed bottom-0 left-0 right-0 bg-slate-900 border-t border-slate-800 p-2 flex justify-around items-center z-50">
                        <MobileNavBtn id="plan" icon="calendar" active={activeTab==='plan'} onClick={setActiveTab} />
                        <MobileNavBtn id="workout" icon="play-circle" active={activeTab==='workout'} onClick={setActiveTab} />
                        <MobileNavBtn id="stats" icon="trophy" active={activeTab==='stats'} onClick={setActiveTab} />
                        <MobileNavBtn id="lib" icon="dumbbell" active={activeTab==='lib'} onClick={setActiveTab} />
                    </div>
                </div>
            );
        }

        const NavBtn = ({ id, icon, label, active, onClick }) => (
            <button onClick={() => onClick(id)} className={`flex items-center gap-2 px-5 py-2 rounded-xl transition-all ${active ? 'bg-indigo-600 text-white active-tab-shadow font-black' : 'text-slate-400 hover:bg-slate-800 font-bold'}`}>
                <Icon name={icon} size={20} />
                <span>{label}</span>
            </button>
        );

        const MobileNavBtn = ({ id, icon, active, onClick }) => (
            <button onClick={() => onClick(id)} className={`p-4 rounded-2xl transition-all ${active ? 'text-indigo-400 bg-indigo-500/10' : 'text-slate-500'}`}>
                <Icon name={icon} size={28} />
            </button>
        );

        function SetupPage({ user, onDone }) {
            const [form, setForm] = useState(user || { height: 170, weight: 70, targetWeight: '' });
            return (
                <div className="max-w-xl mx-auto classic-card p-10 shadow-2xl animate-in fade-in zoom-in duration-500">
                    <h2 className="text-4xl font-black mb-2 italic text-white uppercase tracking-tighter leading-tight">HomeFit <span className="text-indigo-500">Quest</span></h2>
                    <p className="text-slate-500 mb-10 font-bold uppercase tracking-widest text-xs">å€‹äººå¥èº«æª”æ¡ˆè¨­å®š</p>
                    <div className="space-y-6">
                        <div className="grid grid-cols-2 gap-6">
                            <div>
                                <label className="block text-xs font-black text-slate-500 mb-2 uppercase tracking-widest">ç›®å‰èº«é«˜ (cm)</label>
                                <input type="number" className="w-full bg-slate-800 p-5 rounded-2xl text-2xl font-black outline-none focus:ring-2 focus:ring-indigo-500 text-white" value={form.height} onChange={e=>setForm({...form, height: e.target.value})}/>
                            </div>
                            <div>
                                <label className="block text-xs font-black text-slate-500 mb-2 uppercase tracking-widest">ç›®å‰é«”é‡ (kg)</label>
                                <input type="number" className="w-full bg-slate-800 p-5 rounded-2xl text-2xl font-black outline-none focus:ring-2 focus:ring-indigo-500 text-white" value={form.weight} onChange={e=>setForm({...form, weight: e.target.value})}/>
                            </div>
                        </div>
                        <div>
                            <label className="block text-xs font-black text-slate-500 mb-2 uppercase tracking-widest text-indigo-400">ç›®æ¨™é«”é‡ (kg)</label>
                            <input type="number" className="w-full bg-slate-800 p-5 rounded-2xl text-2xl font-black outline-none focus:ring-2 focus:ring-indigo-500 text-white" value={form.targetWeight} placeholder="ä¾‹å¦‚ï¼š65" onChange={e=>setForm({...form, targetWeight: e.target.value})}/>
                        </div>
                        <div className="p-6 bg-indigo-600/10 border border-indigo-500/20 rounded-3xl">
                            <p className="text-indigo-400 font-black mb-1 italic text-lg uppercase tracking-tight"> Habit Builder Mode </p>
                            <p className="text-sm text-slate-400 font-medium">é–å®šæ¨¡å¼ï¼šæ¯æ¬¡ 30 åˆ†é˜ / æ¯é€± 5 å¤©é‹å‹•é‡</p>
                        </div>
                        <button onClick={()=>onDone(form)} className="w-full bg-indigo-600 py-6 rounded-[2rem] text-2xl font-black shadow-xl shadow-indigo-600/30 hover:bg-indigo-500 transition-all text-white">
                            {user ? 'æ›´æ–°ä¸¦ç¹¼çºŒ' : 'é–‹å•Ÿå¥èº«ä»»å‹™'}
                        </button>
                    </div>
                </div>
            );
        }

        function PlanPage({ weekPlan, setWeekPlan, library, onStart }) {
            const gen = () => {
                const cardio = library.filter(e => e.type === 'æœ‰æ°§');
                const strength = library.filter(e => e.type === 'è‚ŒåŠ›');
                const core = library.filter(e => e.type === 'æ ¸å¿ƒ');
                const combined = [...strength, ...core];

                const getActions = (arr, count) => {
                    if (arr.length === 0) return [];
                    let res = [];
                    for(let i=0; i<count; i++) res.push(arr[i % arr.length]);
                    return res;
                };

                const days = [
                    { id: 1, type: 'æœ‰æ°§è¨“ç·´', ex: getActions(cardio, 3) },
                    { id: 2, type: 'è‚ŒåŠ›æ ¸å¿ƒ', ex: getActions(combined, 3) },
                    { id: 3, type: 'èº«é«”ä¿®å¾©', ex: [] },
                    { id: 4, type: 'æœ‰æ°§è¨“ç·´', ex: getActions(cardio, 3) },
                    { id: 5, type: 'è‚ŒåŠ›æ ¸å¿ƒ', ex: getActions(combined, 3) },
                    { id: 6, type: 'èº«é«”ä¿®å¾©', ex: [] },
                    { id: 7, type: 'æœ‰æ°§è¨“ç·´', ex: getActions(cardio, 3) }
                ];
                setWeekPlan(days.map(d => ({ ...d, completed: false })));
            };

            if (weekPlan.length === 0) return (
                <div className="flex flex-col items-center justify-center py-24 text-center">
                    <div className="w-32 h-32 bg-slate-900 rounded-full flex items-center justify-center mb-8 border border-slate-800 shadow-inner"><Icon name="calendar" size={48} className="text-slate-700"/></div>
                    <h3 className="text-3xl font-black mb-4 italic uppercase tracking-tighter text-slate-400">å°šæœªç”Ÿæˆèª²è¡¨</h3>
                    <p className="text-slate-500 mb-10 max-w-sm font-bold">é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œæˆ‘æœƒå¹«ä½ åˆ†é…æœ¬é€±ä»»å‹™ã€‚</p>
                    <button onClick={gen} className="bg-indigo-600 px-12 py-5 rounded-[2rem] text-2xl font-black shadow-xl hover:scale-105 transition-all text-white">ç«‹å³ç”Ÿæˆèª²è¡¨</button>
                </div>
            );

            return (
                <div className="space-y-10 animate-in slide-in-from-bottom-8 duration-500">
                    <div className="flex justify-between items-end">
                        <div>
                            <h2 className="text-5xl font-black italic tracking-tighter uppercase text-white leading-none">Weekly <span className="text-indigo-500 font-light">Quest</span></h2>
                            <p className="text-slate-500 font-bold mt-2 italic tracking-wide">å …æŒåˆ°åº•ï¼Œæˆå°±éå‡¡</p>
                        </div>
                        <button onClick={gen} className="text-slate-600 font-bold hover:text-indigo-400 border-b border-transparent hover:border-indigo-400 transition-all uppercase tracking-widest text-xs">é‡æ–°æ’åˆ—</button>
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-7 gap-4">
                        {weekPlan.map(day => (
                            <div key={`plan-day-${day.id}`} className={`p-6 rounded-[2rem] border-2 transition-all ${day.completed ? 'bg-indigo-950/40 border-indigo-500/50' : day.type.includes('ä¿®å¾©') ? 'bg-slate-900/30 border-slate-800 opacity-40' : 'bg-slate-900 border-slate-800'}`}>
                                <p className="text-xs font-black text-slate-500 mb-4 tracking-widest uppercase text-center">DAY {day.id}</p>
                                <h4 className="text-xl font-black mb-1 text-center text-white">{day.type}</h4>
                                {day.completed ? (
                                    <div className="mt-4 text-emerald-400 font-black italic text-xs flex items-center justify-center gap-1"><Icon name="check-circle-2" size={14}/> DONE</div>
                                ) : day.type.includes('ä¿®å¾©') ? (
                                    <div className="mt-4 text-slate-600 font-bold italic text-xs text-center uppercase tracking-tighter">Rest</div>
                                ) : (
                                    <div className="mt-4 text-indigo-400/50 font-bold italic text-xs text-center uppercase tracking-widest">Active</div>
                                )}
                            </div>
                        ))}
                    </div>
                    <div className="bg-gradient-to-br from-indigo-900/50 to-slate-900 p-10 rounded-[3rem] border border-indigo-500/20 flex flex-col md:flex-row justify-between items-center gap-8 shadow-2xl relative overflow-hidden group">
                        <div className="absolute top-0 right-0 p-10 opacity-5 -rotate-12 group-hover:rotate-0 transition-all duration-1000"><Icon name="flame" size={200} /></div>
                        <div className="relative z-10">
                            <h3 className="text-3xl font-black mb-2 italic uppercase text-white tracking-tighter leading-none">ä»Šæ—¥ç›®æ¨™ä»»å‹™</h3>
                            <p className="text-indigo-300 font-bold text-lg mt-2 italic">åˆ†é¡ï¼š{weekPlan.find(d => !d.completed && !d.type.includes('ä¿®å¾©'))?.type || 'äº«å—ä¿®é¤Šæ—¥'}</p>
                        </div>
                        <button onClick={onStart} className="relative z-10 bg-white text-indigo-950 font-black px-16 py-6 rounded-[2.5rem] text-3xl shadow-2xl hover:bg-indigo-50 hover:scale-105 transition-all">START QUEST</button>
                    </div>
                </div>
            );
        }

        function WorkoutPlayer({ weekPlan, onFinish }) {
            const dayIdx = weekPlan.findIndex(d => !d.completed && !d.type.includes('ä¿®å¾©'));
            const today = weekPlan[dayIdx];
            const [curExIdx, setCurExIdx] = useState(0);
            const [time, setTime] = useState(0);
            const [active, setActive] = useState(false);
            const curEx = today?.ex[curExIdx];

            useEffect(() => { if (curEx) { setTime(curEx.duration * 60); setActive(false); } }, [curExIdx, curEx]);
            useEffect(() => {
                let t;
                if (active && time > 0) t = setInterval(() => setTime(s => s - 1), 1000);
                return () => clearInterval(t);
            }, [active, time]);

            if (!today) return (
                <div className="text-center py-20 animate-in fade-in zoom-in duration-500">
                    <div className="w-40 h-40 bg-indigo-600/10 rounded-full flex items-center justify-center mx-auto mb-10 border border-indigo-500/20 shadow-inner"><Icon name="check-circle-2" size={80} className="text-indigo-500" /></div>
                    <h2 className="text-5xl font-black italic uppercase mb-4 tracking-tighter text-white uppercase leading-none">All Targets Clear!</h2>
                    <p className="text-slate-500 text-xl font-bold uppercase italic mt-4">ä»Šå¤©çš„æ±—æ°´ï¼Œæœƒæˆç‚ºæ˜å¤©çš„é©•å‚²ã€‚ğŸ»</p>
                </div>
            );

            const ytId = (u) => {
                const m = u?.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);
                return (m && m[2].length === 11) ? m[2] : '';
            };

            return (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 animate-in zoom-in-95 duration-500">
                    <div className="lg:col-span-2 space-y-6">
                        <div className="video-container shadow-2xl border border-slate-800 bg-black">
                            <iframe key={curEx?.id} src={`https://www.youtube.com/embed/${ytId(curEx?.ytUrl)}?autoplay=0&modestbranding=1&rel=0`} frameBorder="0" allowFullScreen></iframe>
                        </div>
                        <div className="classic-card p-10 flex flex-col md:flex-row justify-between items-center gap-8 shadow-2xl relative overflow-hidden">
                            <div className="absolute top-0 right-0 p-8 opacity-5"><Icon name="play" size={150}/></div>
                            <div className="text-center md:text-left relative z-10">
                                <p className="text-indigo-400 font-black tracking-widest text-xs uppercase mb-1 font-mono uppercase">Current Mission</p>
                                <h3 className="text-5xl font-black tracking-tighter uppercase leading-tight text-white">{curEx?.name}</h3>
                                <div className={`inline-block mt-3 px-4 py-1 rounded-full border text-xs font-black uppercase ${getTypeColor(curEx?.type)}`}>{curEx?.type}</div>
                            </div>
                            <div className="flex flex-col items-center md:items-end gap-4 relative z-10">
                                <div className={`text-8xl font-mono font-black tabular-nums ${time < 30 ? 'text-red-500 animate-pulse' : 'text-white'}`}>
                                    {Math.floor(time/60)}:{(time%60).toString().padStart(2,'0')}
                                </div>
                                <button onClick={() => setActive(!active)} className={`px-12 py-4 rounded-2xl font-black text-2xl shadow-lg transition-all active:scale-95 ${active ? 'bg-slate-800 text-slate-400 border border-slate-700' : 'bg-indigo-600 text-white shadow-indigo-600/30'}`}>
                                    {active ? 'PAUSE' : 'START TIMER'}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div className="classic-card p-10 flex flex-col shadow-2xl border-indigo-500/10 h-full">
                        <h3 className="text-xl font-black mb-10 italic text-slate-500 tracking-widest uppercase border-b border-slate-800 pb-4">ä»Šæ—¥æŒ‘æˆ°æ­¥é©Ÿ</h3>
                        <div className="flex-1 space-y-4 mb-10 overflow-y-auto no-scrollbar">
                            {today.ex.map((e, i) => (
                                <div key={`ex-step-${i}`} className={`p-5 rounded-[1.5rem] border-2 flex items-center gap-5 transition-all ${i === curExIdx ? 'bg-indigo-600/10 border-indigo-500 ring-4 ring-indigo-500/10 scale-105 shadow-xl' : 'bg-slate-800/20 border-slate-800 opacity-40'}`}>
                                    <div className={`w-12 h-12 rounded-2xl flex items-center justify-center font-black text-xl shadow-inner ${i === curExIdx ? 'bg-indigo-600 text-white shadow-lg' : 'bg-slate-800 text-slate-700'}`}>{i + 1}</div>
                                    <div className={`flex-1 font-black text-xl ${i === curExIdx ? 'text-white font-bold' : 'text-slate-500'}`}>{e.name}</div>
                                    <div className="text-xs font-bold text-slate-600 italic tracking-tighter font-mono">{e.duration}m</div>
                                </div>
                            ))}
                        </div>
                        <button onClick={() => curExIdx < today.ex.length - 1 ? setCurExIdx(curExIdx + 1) : onFinish(dayIdx)} className="w-full bg-white text-indigo-950 font-black py-8 rounded-[2rem] text-3xl shadow-2xl hover:bg-slate-100 active:scale-95 transition-all uppercase italic">
                            {curExIdx < today.ex.length - 1 ? 'Next Step' : 'Finish & Stamp'}
                        </button>
                    </div>
                </div>
            );
        }

        function StatsPage({ stats, weekPlan, rewards, setRewards }) {
            const quote = MOTIVATION_QUOTES[Math.floor(Math.random() * MOTIVATION_QUOTES.length)];
            const [newReward, setNewReward] = useState("");

            const addReward = () => {
                if(!newReward.trim()) return;
                setRewards([...rewards, { id: Date.now(), text: newReward, isClaimed: false }]);
                setNewReward("");
            };

            const toggleReward = (id) => {
                setRewards(rewards.map(r => r.id === id ? { ...r, isClaimed: !r.isClaimed } : r));
            };

            const deleteReward = (id) => {
                setRewards(rewards.filter(r => r.id !== id));
            };

            return (
                <div className="space-y-12 animate-in fade-in duration-700">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <StatCard title="ç´¯ç©é‹å‹•" value={stats.totalCompleted || 0} unit="æ¬¡" icon="trophy" color="border-yellow-500/20 text-yellow-500" iconBg="bg-yellow-500/10" />
                        <StatCard title="é€£çºŒå¤©æ•¸" value={stats.streak || 0} unit="å¤©" icon="flame" color="border-orange-500/20 text-orange-500" iconBg="bg-orange-500/10" />
                        <StatCard title="æœ¬é€±è“‹ç« " value={`${weekPlan.filter(d=>d.completed).length}/5`} unit="" icon="award" color="border-indigo-500/20 text-indigo-500" iconBg="bg-indigo-500/10" />
                    </div>

                    <div className="classic-card p-12 text-center relative overflow-hidden shadow-[0_40px_100px_-20px_rgba(79,70,229,0.3)]">
                        <div className="absolute top-0 right-0 p-16 opacity-5 -rotate-12 pointer-events-none text-white"><Icon name="medal" size={450} /></div>
                        <h3 className="text-3xl font-black mb-16 italic uppercase tracking-[0.4em] text-slate-600 text-white tracking-widest">ä»»å‹™å°ç« ç‰†</h3>
                        <div className="flex flex-wrap justify-center gap-8 mb-16 relative z-10">
                            {[1,2,3,4,5,6,7].map((num, i) => {
                                const isDone = weekPlan[i]?.completed;
                                const isRest = weekPlan[i]?.type?.includes('ä¿®å¾©');
                                return (
                                    <div key={`stamp-${i}`} className="flex flex-col items-center gap-4">
                                        <div className={`w-28 h-28 md:w-32 md:h-32 rounded-[2.5rem] flex items-center justify-center border-4 transition-all duration-1000 ${isDone ? 'bg-indigo-600 border-indigo-400 rotate-6 scale-110 shadow-2xl shadow-indigo-600/50' : isRest ? 'bg-slate-800/40 border-slate-700 border-dashed opacity-20' : 'bg-slate-900 border-slate-800 opacity-40'}`}>
                                            {isDone ? <Icon name="check" size={64} className="text-white" /> : isRest ? <Icon name="coffee" size={32} className="text-slate-600" /> : <span className="text-slate-700 font-black text-4xl">{num}</span>}
                                        </div>
                                        <span className="text-xs font-black text-slate-700 tracking-widest uppercase">DAY {num}</span>
                                    </div>
                                );
                            })}
                        </div>
                        <div className="relative z-10 py-10 border-t border-slate-800/50 max-w-2xl mx-auto">
                            <p className="text-6xl font-black italic text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 via-white to-indigo-200 tracking-tighter leading-tight leading-none tracking-tighter">ã€Œ {quote} ã€</p>
                        </div>
                    </div>

                    {/* é”æˆçå‹µå€ */}
                    <div className="classic-card p-10 border-indigo-500/20 shadow-xl">
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-6">
                            <div>
                                <h3 className="text-3xl font-black italic uppercase tracking-tighter text-white">REWARD <span className="text-indigo-500 font-normal">QUEST</span></h3>
                                <p className="text-slate-500 font-bold mt-1 tracking-wide">å®Œæˆé‹å‹•ä»»å‹™ï¼Œå°±çµ¦è‡ªå·±ä¸€é»ç”œé ­å§ï¼</p>
                            </div>
                            <div className="flex gap-2 w-full md:w-auto">
                                <input 
                                    type="text" 
                                    placeholder="è¼¸å…¥æ–°çå‹µï¼Œä¾‹å¦‚ï¼šæ‰“å¡ 5 æ¬¡å»åƒå¤§é¤..." 
                                    className="flex-1 md:flex-none bg-slate-800 p-4 rounded-xl font-bold outline-none focus:ring-2 focus:ring-indigo-500 text-white md:min-w-[300px] border border-slate-700"
                                    value={newReward}
                                    onChange={(e)=>setNewReward(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && addReward()}
                                />
                                <button onClick={addReward} className="bg-indigo-600 p-4 rounded-xl font-black hover:bg-indigo-500 transition-all text-white shadow-lg shadow-indigo-600/20"><Icon name="plus"/></button>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {rewards.length === 0 && <p className="text-slate-600 font-bold italic py-8 text-center border border-dashed border-slate-800 rounded-2xl">ç›®å‰é‚„æ²’æœ‰çå‹µé …ç›®ï¼Œå¿«ä¾†æ–°å¢ä¸€å€‹å§ï¼</p>}
                            {rewards.map(r => (
                                <div key={r.id} className={`p-6 rounded-2xl border-2 flex items-center justify-between transition-all ${r.isClaimed ? 'bg-emerald-950/20 border-emerald-500/30 opacity-60' : 'bg-slate-800/40 border-slate-800 group hover:border-indigo-500/50'}`}>
                                    <div className="flex items-center gap-4">
                                        <button onClick={() => toggleReward(r.id)} className={`w-10 h-10 rounded-xl border-2 flex items-center justify-center transition-all ${r.isClaimed ? 'bg-emerald-500 border-emerald-500' : 'border-slate-600 bg-slate-900 group-hover:border-indigo-400'}`}>
                                            {r.isClaimed && <Icon name="check" size={20} className="text-white"/>}
                                        </button>
                                        <span className={`text-xl font-black tracking-tight ${r.isClaimed ? 'text-slate-500 line-through font-normal' : 'text-white font-bold'}`}>{r.text}</span>
                                    </div>
                                    <button onClick={() => deleteReward(r.id)} className="text-slate-600 hover:text-red-500 p-2"><Icon name="trash" size={20}/></button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        function StatCard({ title, value, unit, icon, color, iconBg }) {
            return (
                <div className={`classic-card p-10 flex items-center justify-between border-2 ${color} transition-transform hover:scale-[1.02]`}>
                    <div>
                        <p className="text-slate-500 font-black text-xs uppercase tracking-widest mb-2 font-mono uppercase">{title}</p>
                        <p className="text-7xl font-black tracking-tighter text-white leading-none leading-none tracking-tighter">{value}<span className="text-xl text-slate-600 ml-1 font-bold">{unit}</span></p>
                    </div>
                    <div className={`p-6 ${iconBg} rounded-[2rem] shadow-inner border border-white/5`}><Icon name={icon} size={40}/></div>
                </div>
            );
        }

        function LibraryPage({ library, setLibrary }) {
            const [modal, setModal] = useState({ open: false, data: null });
            const [form, setForm] = useState({ name: '', type: 'æœ‰æ°§', ytUrl: '', duration: 5 });

            const handleSave = () => {
                if (!form.name) return;
                if (modal.data) {
                    setLibrary(library.map(e => e.id === modal.data.id ? { ...form, id: modal.data.id } : e));
                } else {
                    setLibrary([...library, { ...form, id: Date.now().toString() }]);
                }
                setModal({ open: false, data: null });
            };

            return (
                <div className="space-y-10 animate-in fade-in duration-500">
                    <div className="flex justify-between items-center">
                        <h2 className="text-4xl font-black italic uppercase tracking-tighter text-white leading-none">Action <span className="text-indigo-500 font-light">Vault</span></h2>
                        <button onClick={()=>{setForm({name:'', type:'æœ‰æ°§', ytUrl:'', duration:5}); setModal({open:true, data:null});}} className="bg-indigo-600 px-10 py-4 rounded-[1.5rem] font-black flex items-center gap-3 shadow-lg shadow-indigo-600/20 hover:scale-105 transition-all text-white"><Icon name="plus" size={20}/> æ–°å¢é …ç›®</button>
                    </div>
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                        {library.map(ex => (
                            <div key={ex.id} className="classic-card p-8 group border-transparent hover:border-indigo-500/50 transition-all flex flex-col justify-between h-full shadow-lg">
                                <div>
                                    <div className="flex justify-between items-start mb-8">
                                        <span className={`px-4 py-1 border rounded-full text-xs font-black uppercase tracking-widest ${getTypeColor(ex.type)}`}>{ex.type}</span>
                                        <div className="flex gap-3">
                                            <button onClick={()=>{setForm(ex); setModal({open:true, data:ex});}} className="text-slate-600 hover:text-indigo-400 transition-colors p-1"><Icon name="edit-3" size={18}/></button>
                                            <button onClick={()=>setLibrary(library.filter(i=>i.id!==ex.id))} className="text-slate-600 hover:text-red-500 transition-colors p-1"><Icon name="trash" size={18}/></button>
                                        </div>
                                    </div>
                                    <h3 className="text-3xl font-black mb-2 tracking-tight text-white group-hover:text-indigo-400 transition-colors uppercase italic leading-tight">{ex.name}</h3>
                                    <p className="text-slate-500 font-bold mb-6 italic text-sm tracking-wide uppercase font-mono"><Icon name="clock" size={14} className="inline mr-1"/> æ¯å›åˆ {ex.duration} åˆ†é˜</p>
                                </div>
                                <div className="mt-auto pt-6 border-t border-slate-800">
                                    <a href={ex.ytUrl} target="_blank" rel="noreferrer" className="text-indigo-400 font-black flex items-center gap-2 group-hover:text-white transition-colors italic uppercase tracking-tighter font-bold"><Icon name="youtube" size={20}/> ç¤ºç¯„é€£çµ</a>
                                </div>
                            </div>
                        ))}
                    </div>
                    {modal.open && (
                        <div className="fixed inset-0 bg-slate-950/95 z-[100] flex items-center justify-center p-4 backdrop-blur-md">
                            <div className="bg-slate-900 w-full max-w-xl p-10 rounded-[3rem] border border-slate-800 shadow-2xl animate-in zoom-in duration-300">
                                <h3 className="text-3xl font-black mb-8 italic uppercase tracking-tighter text-white tracking-tighter leading-none">{modal.data ? 'ç·¨è¼¯é‹å‹•é …ç›®' : 'æ–°å¢é‹å‹•é …ç›®'}</h3>
                                <div className="space-y-6">
                                    <div>
                                        <label className="text-xs font-black text-slate-500 uppercase tracking-widest mb-2 block font-bold">åç¨±</label>
                                        <input placeholder="ä¾‹å¦‚ï¼šè¶…æ…¢è·‘..." className="w-full bg-slate-800 p-5 rounded-2xl text-xl font-black outline-none focus:ring-2 focus:ring-indigo-500 text-white border border-slate-700" value={form.name} onChange={e=>setForm({...form, name:e.target.value})} />
                                    </div>
                                    <div>
                                        <label className="text-xs font-black text-slate-500 uppercase tracking-widest mb-2 block font-mono font-bold font-mono">YouTube URL</label>
                                        <input placeholder="è²¼ä¸Šå®Œæ•´é€£çµ..." className="w-full bg-slate-800 p-5 rounded-2xl font-mono text-sm text-indigo-300 outline-none focus:ring-2 focus:ring-indigo-500 border border-slate-700" value={form.ytUrl} onChange={e=>setForm({...form, ytUrl:e.target.value})} />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="text-xs font-black text-slate-500 uppercase tracking-widest mb-2 block font-bold">åˆ†é¡</label>
                                            <select className="w-full bg-slate-800 p-5 rounded-2xl font-black outline-none focus:ring-2 focus:ring-indigo-500 text-white border border-slate-700" value={form.type} onChange={e=>setForm({...form, type:e.target.value})}><option>æœ‰æ°§</option><option>è‚ŒåŠ›</option><option>æ ¸å¿ƒ</option></select>
                                        </div>
                                        <div>
                                            <label className="text-xs font-black text-slate-500 uppercase tracking-widest mb-2 block font-bold">æ™‚é•· (åˆ†)</label>
                                            <input type="number" className="w-full bg-slate-800 p-5 rounded-2xl font-black outline-none focus:ring-2 focus:ring-indigo-500 text-white border border-slate-700" value={form.duration} onChange={e=>setForm({...form, duration:e.target.value})} />
                                        </div>
                                    </div>
                                    <div className="flex gap-4 mt-10">
                                        <button onClick={()=>setModal({open:false, data:null})} className="flex-1 bg-slate-800 py-6 rounded-[2rem] font-black text-lg hover:bg-slate-700 transition-colors text-white uppercase italic tracking-tighter">Cancel</button>
                                        <button onClick={handleSave} className="flex-1 bg-indigo-600 py-6 rounded-[2rem] font-black text-lg shadow-xl shadow-indigo-600/20 hover:bg-indigo-500 transition-colors text-white uppercase italic tracking-tighter">Save</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>